#!/bin/bash

#creat the directories of 10 date's pair for testset
#for i in 2008-02-06-2008-04-05 2008-04-06-2008-06-04 2008-06-05-2008-08-03 2008-08-04-2008-10-02 2008-10-03-2008-12-01 2008-12-02-2009-01-30 2009-05-31-2009-07-29 2009-05-31-2009-07-29 2009-05-31-2009-07-29 2009-07-30-2009-09-27
#do 
  #mkdir $i
#done

#change path to the location of your jackrabbit repository    
cd /home/shuaili/BI/jackrabbit

# the [commit_id]:[path] within the corresponing time period, for example, here are all the[commit_id]:[path] from 2008-02-06 to 2008-04-05, you need to modify it if you change the time period. I have attached different charvector.py in each directories.
for i in 9d67a596e7db52ee2ddb9a2e950414c1e416af48:jackrabbit-spi2dav/src/main/java/org/apache/jackrabbit/spi2dav/RepositoryServiceImpl.java 1992ee15ce7d3b1ec0ec482da0c42e6523259377:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/SearchIndex.java 37d4fed78932a8124387e9fdef6195a9d83cc992:jackrabbit-spi2dav/src/main/java/org/apache/jackrabbit/spi2dav/RepositoryServiceImpl.java 9a97ab77219813eedcc8c49677e521564ec0fb90:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/security/user/AuthorizableImpl.java 156ebcde3600c4ca74cb9b418e25897f291dc783:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/NodeImpl.java 79a58ccfe00a29e8c94c215eefaa57be11abaa1d:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/value/InternalValue.java f02a69bb43d8c45cd2034f005356436bb424b8f5:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/value/BLOBFileValue.java 31f3ce15b09da82320a82d312dcc3bc29266be6a:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/value/InternalValue.java c9e9878298ffeaefe32018ff69b68b09c3c28b99:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/AbstractVersionManager.java 2c74f6c8fd66981622db87f55d91f8ad915ccff0:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/value/InternalValueFactory.java 7cbced94f45767c0af34f7ad78c3e4573a02952d:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/ItemImpl.java 65e437d81a3f8e2be0e1afb7e196a79f20e8208e:jackrabbit-jcr-client/src/main/java/org/apache/jackrabbit/client/RepositoryFactoryImpl.java c6a358498a806deac3218393a16bcdd7f62bd3a4:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/security/JackrabbitSecurityManager.java bc6234ec33350a8705fc1c4a5f3f4b2513724b91:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/SharedItemStateManager.java 5c67ebf168264c8e7447a189f8e2d287c159968e:jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/nodetype/NodeTypeTemplateImpl.java 63511c9fa27ecaac1d2119ce4b85b10267331ee1:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/security/user/AuthorizableImpl.java 9a41ccf7c68378ef036be4b5f6492c42bf6f85b4:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/security/authorization/principalbased/ACLProvider.java 5801842a5cd9ac9f9b533ddbc97c7bfa658d4c25:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/SharedItemStateManager.java 88db1d7153a7eaabc9386f5f6130138283baf7f4:jackrabbit-spi2jcr/src/main/java/org/apache/jackrabbit/spi2jcr/QueryResultRowImpl.java b62bb58575b647ec01080c2d83ad55d1dbde8099:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/SessionItemStateManager.java 4bce70606ae822c62c294e9987d2b1017ccc0113:jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/jcr/search/SearchResourceImpl.java b57654e9b270169eab38bf528b2f27d7311cdce3:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/ItemManager.java f4f35f303733c3bd826308c173b8649e92b28209:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/LuceneQueryBuilder.java 6cd808be5427208e15e2a76ed055e461beb57ca6:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/fs/db/MSSqlFileSystem.java 5479882701456a081ac73e8604eb79752832aac6:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/cluster/ClusterNode.java 6aa1d34ba7210a35b803845288404394fe18d17b:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/SharedItemStateManager.java 725bb30e3bb3750aec59d50f55c1cd2172a5156d:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/DefaultSecurityManager.java 1510610ff6120f38158dd107d325e2e62e29dc4f:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/BatchedItemOperations.java a5b9d730cebfe5087a36dd0516d7e08ff906007a:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/persistence/bundle/util/BundleBinding.java bc2e4bb9dca2f7c7e4be58c5c9301b0f1416e727:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/SearchIndex.java c3d1296b097053b8a033895a0d90ed559e5361bb:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/ChildNodeEntries.java 5f12cbc80e3b31339226e7bef37c0f93cd89b082:jackrabbit-spi2jcr/src/main/java/org/apache/jackrabbit/spi2jcr/QueryInfoImpl.java 78699321d8f5342192bc1f18b7edfb57be428273:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/PropertyImpl.java 4a40cc1fa40b1d83e7dd202df4f10c88cc8b946f:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/security/user/UserManagerImpl.java f039f508f3408daa22387a188efd81a2b9890c2f:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/query/lucene/AbstractExcerpt.java 8eb801373253558a81f5fa32dc4386a97a217bac:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/InternalBaselineImpl.java 95c5be20d67f27f0439be01c24c3ffcd91c8ea94:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/VersionManagerImpl.java dc412e9d82671b09cb00de45bee1430a618c2242:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/InternalVersionHistoryImpl.java 93d60f74ad12942e2554370f956f1d98a898a51c:jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/nodetype/NodeDefinitionTemplateImpl.java 13df50215fdb14ff05d33c7d66d84ad998249a49:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/version/VersionManagerImplRestore.java 59d3d2af2829ca0b54a3cd65a3bf2a3aa7663906:jackrabbit-core/src/main/java/org/apache/jackrabbit/core/NodeImpl.java

do 
#remove everything except digits, extract the commit id from the string.
SUBSTRING=$(echo $i| tr -cd '[[:digit:]]') 
#you can change the path where you want to store the after change source java code files 
git show $i >/home/shuaili/charvector/testset/2009-05-31-2009-07-29/afterchange/$SUBSTRING.java
#store the latest version of file before changes 
PREVIOUS=$(echo $i| sed 's/:/~1:/')
#you can change the path where you want to store the beforechange source java code files
git show $PREVIOUS >/home/shuaili/charvector/testset/2009-05-31-2009-07-29/beforechange/$SUBSTRING~1.java 
done
#run Deckard, you need to change to the directory where the config file located
cd /home/shuaili/charvector/testset/2009-05-31-2009-07-29
/home/shuaili/Deckard/scripts/clonedetect/deckard.sh

